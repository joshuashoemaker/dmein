!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("dmein",[],e):"object"==typeof exports?exports.dmein=e():t.dmein=e()}(this,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}r.r(e),r.d(e,"Table",(function(){return o})),r.d(e,"Nodule",(function(){return i})),r.d(e,"FilterNodule",(function(){return d})),r.d(e,"JoinNodule",(function(){return w})),r.d(e,"TransformNodule",(function(){return L}));var o=function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.getProperties=function(){return{id:r.id,label:r.label,rows:r.rows,type:r.type,isValid:r.isValid}},this.export=function(){return r.rows},this.setRows=function(t){var e=r._validateRows(t);if("ERR"===e.status)throw e;Array.isArray(t)?r.rows=t:r.rows=[t]},this._assignProps=function(t){r.id=t.id,r.label=t.label,r.type="Table",r.isValid=!0,t.rows?r.setRows(t.rows):r.rows=[]},this._validateConstructionProps=function(t){var e={status:"ERR",error:{label:"Error Creating Table",messages:[]}};return t?(t.id||e.error.messages.push("No id on creation of Table"),t.label||e.error.messages.push("No label on creation of Table"),0===e.error.messages.length?{status:"OK"}:e):(e.error.messages.push("No props on creation of Table"),e)},this._validateRows=function(t){var e={status:"ERR",error:{label:"Error Creating Table",messages:[]}},r=[];0===(r=Array.isArray(t)?t:[t]).length&&e.error.messages.push("No Tables imported");for(var o=0;o<r.length;o++)"object"!==n(r[o])&&e.error.messages.push("row[".concat(o,"] is not an object"));return e.error.messages.length>0?e:{status:"OK"}};var o=this._validateConstructionProps(e);if("ERR"===o.status)throw o;this._assignProps(e)};var i=function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.asTable=function(){if(!r.export)return null;try{return new o({id:r.id,label:r.label,rows:r.export()})}catch(t){throw t}},this.getProperties=function(){var t=[];return t=Array.isArray(r.tables)?0===r.tables.length?[]:r.tables.map((function(t){return t.getProperties()})):[],{id:r.id,label:r.label,type:r.type,tables:t,isValid:r.isValid}},this.importTables=function(t){var e=r._validateTables(t);if("ERR"===e.status)throw e;var n=[];n=Array.isArray(t)?t:[t],r.tables=n},this._assignProps=function(t){r.id=t.id,r.label=t.label,r.type="Nodule",r.isValid=!0,t.tables?r.importTables(t.tables):r.tables=[]},this._validateTables=function(t){var e={status:"ERR",error:{label:"Not all imported Tables are valid",messages:[]}},r=[];if(!t)return e.error.messages.push("No Tables imported"),e;r=Array.isArray(t)?t:[t];for(var n=0;n<r.length;n++)r[n].isValid||e.error.messages.push("Table[".concat(n,"] is not valid"));return 0===e.error.messages.length?{status:"OK"}:e},this._validateConstructionProps=function(t){var e={status:"ERR",error:{label:"Error Creating Node",messages:[]}};return t.id||e.error.messages.push("No id on creation of Node"),t.label||e.error.messages.push("No label on creation of Node"),0===e.error.messages.length?{status:"OK"}:e};var n=this._validateConstructionProps(e);if("ERR"===n.status)throw n;this._assignProps(e)},a={EQUAL:"EQUAL",GREATER:"GREATER",GREATEREQUAL:"GREATEREQUAL",LESSER:"LESSER",LESSEREQUAL:"LESSEREQUAL"};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){f(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function f(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=b(t);if(e){var o=b(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return y(this,r)}}function y(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(r,t);var e=p(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t)).addFilter=function(t){var e=n._validateFilters(t);if("ERR"===e.status)throw e;n.filterParams=c(c({},n.filterParams),t)},n.setFilterType=function(t){var e=n._validateType(t);if("ERR"===e.status)throw e;n.filterType=t},n.export=function(){var t=n.tables.map((function(t){return t.export()})).flat();return n._createFilterMethods().forEach((function(e){t=t.filter(e)})),t},n._assignProps=function(t){n.filterParams=t.filterParams||{},t.filterType&&n.setFilterType(t.filterType)},n._createFilterMethods=function(){var t=n._validateType(n.filterType);if("OK"!==t.status)throw t;var e=[],r=function(t){var r={};n.filterType===a.EQUAL?r=function(e){return e[t]===n.filterParams[t]}:n.filterType===a.GREATER?r=function(e){return e[t]>n.filterParams[t]}:n.filterType===a.GREATEREQUAL?r=function(e){return e[t]>=n.filterParams[t]}:n.filterType===a.LESSER?r=function(e){return e[t]<n.filterParams[t]}:n.filterType===a.LESSEREQUAL&&(r=function(e){return e[t]<=n.filterParams[t]}),e.push(r)};for(var o in n.filterParams)r(o);return e},n._validateFilters=function(t){var e={status:"ERR",error:{label:"Filter Parameter are not valid",messages:[]}};if("object"!==s(t)){var r=s(t);e.error.messages.push("Filter was of type ".concat(r," should be an object"))}return e.error.messages.length>0?e:{status:"OK"}},n._validateType=function(t){var e={status:"ERR",error:{label:"Filter Type is not valid",messages:[]}};return Object.values(a).indexOf(t)<0&&e.error.messages.push("Type must be one of: ".concat(Object.keys(a))),e.error.messages.length>0?e:{status:"OK"}},n._assignProps(t),n}return r}(i);function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach((function(e){g(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function g(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=R(t);if(e){var o=R(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return j(this,r)}}function j(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function R(t){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(r,t);var e=P(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t)).export=function(){var t=n.tables.find((function(t){return t.label===n.baseTableLabel})).export(),e=n.tables.filter((function(t){return t.label!==n.baseTableLabel}));return n.joinParams.map((function(r){var n=e.find((function(t){return t.label===r.foreignTable})).export();return t.map((function(t){var e=n.find((function(e){return t[r.primaryTableKey]===e[r.matchingKey]})),o={};for(var i in e)o["".concat(r.foreignTable,"::").concat(i)]=e[i];return v(v({},t),o)}))}))[0]},n.setJoinBy=function(t){var e=n._validateJoinBy(t);if("ERR"===e.status)throw e;n.baseTableLabel=t.baseTableLabel,n.joinParams=t.joinParams},n._assignProps=function(t){t.joinBy&&n.setJoinBy(t.joinBy)},n._validateJoinBy=function(t){var e={status:"ERR",error:{label:"JoinBy Parameters are not valid",messages:[]}},r=t.baseTableLabel,n=t.joinParams;if(r||e.error.messages.push("No baseTableLabel provided"),!Array.isArray(n)){var o=h(n);return e.error.messages.push("Keys was of type ".concat(o," should be an array")),e}for(var i=0;i<n.length;i++)"object"!==h(n[i])&&e.error.messages.push("joinParams[".concat(i,"] is not an object"));return e.error.messages.length>0?e:{status:"OK"}},n._assignProps(t),n}return r}(i);function E(t){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function T(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return _(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function A(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=N(t);if(e){var o=N(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return x(this,r)}}function x(t,e){return!e||"object"!==E(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function N(t){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var L=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}(r,t);var e=A(r);function r(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,t)).export=function(){return n.tables.map((function(t){return t.export()})).flat().map((function(t){for(var e={},r=0,o=Object.entries(n.structure);r<o.length;r++){var i=T(o[r],2),a=i[0];e[i[1]]=t[a]}return e}))},n.setStructure=function(t){var e=n._validateStructureProps(t);if("ERR"===e.status)throw e;n.structure=t},n._assignProps=function(t){t.structure&&n.setStructure(t.structure)},n._validateStructureProps=function(t){var e={status:"ERR",error:{label:"Ptructure Parameters are not valid",messages:[]}};if(!t)return e.error.messages.push("No structure provided"),e;for(var r in t)"string"!=typeof t[r]&&e.error.messages.push("Key [".concat(t,"] is not a String"));return e.error.messages.length>0?e:{status:"OK"}},n._assignProps(t),n}return r}(i);e.default={Table:o,Nodule:i,FilterNodule:d,JoinNodule:w,TransformNodule:L}}])}));